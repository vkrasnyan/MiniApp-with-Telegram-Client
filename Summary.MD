Summary

Описание

Приложение на FastAPI с использованием Telethon для взаимодействия с Telegram. Обрабатывает события из Telegram, интегрируется с OpenAI API и предоставляет функционал для отображения и управления данными через веб-интерфейс.

Добавленный функционал

1. Получение списка чатов

- Метод get_dialogs() используется для получения всех чатов (личные сообщения, группы, каналы).

- Отображение чатов реализовано через шаблон dialogs.html.

2. Обработка новых сообщений

- Используется client.add_event_handler для обработки событий NewMessage.

- Определяется тип чата (личный, группа, канал).

- Извлекается информация об отправителе (имя, фамилия, ID).

- Собранные данные сохраняются в переменную messages_data и отображаются через шаблон messages.html.

3. Интеграция с OpenAI

- Текст сообщения отправляется в OpenAI API для обработки с помощью openai.ChatCompletion.create.

- Ответ от OpenAI сохраняется, проверяется и при необходимости обрабатывается.

- Ответ отправляется пользователю в Telegram с помощью event.reply(). Кроме того, вся информация выводится в шаблоне sender_info.html


Добавлены шаблоны:

- dialogs.html для отображения списка чатов.

- sender_info.html для отображения данных пользователя обработанных сообщений.

Структура проекта была изменена (проект разбит на модули, что значительно улучшаетт читаемость и структуру проекта)

project/
|-- app/
|   |-- __init__.py     # Инициализация приложения
|   |-- main.py         # Точка входа
|   |-- config.py       # Конфигурация проекта
|   |-- database.py     # Настройки базы данных
|   |-- routers.py      # Роуты FastAPI (можно разделить на отдельные роуты)
|   |-- dependencies.py # Повторяющиеся в коде функции
|   |-- models.py       # SQLAlchemy модели
|   |-- schemas.py      # Схемы для pydantic
|   |-- templates/      # Шаблоны HTML
|   |   |-- dialogs.html
|   |   |-- sender_info.html
|   |   |-- other templates
|   |-- static/         # Статические файлы (CSS, JS, изображения)
|       |-- styles.css
|   |-- telegram_clients.py # Работа с TelegramClient


Основные файлы

main.py

- Инициализация приложения
- Запуск фоновой задачи для обработки сообщений.
- Настройка роутов и middleware для работы приложения.
- Роут для отображения страницы index.html
- Запуск приложения

telegram_clients.py

- Создание и конфигурация Telethon клиента.

- Обработка событий NewMessage.

- Интеграция с OpenAI API.

- Логирование и сбор информации о сообщениях.

dialogs.html

- Шаблон для отображения списка чатов Telegram.

sender_info.html

- Шаблон для отображения собранных сообщений и ответов от OpenAI.




